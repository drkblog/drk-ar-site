var sidila;(()=>{var t={498:(t,s)=>{!function(){"use strict";function t(t,s,e){this.text=t,this.offset=s,this.elements=e}t.prototype.forEach=function(t,s){for(var e=this.elements,i=0,h=e.length;i<h;i++)t.call(s,e[i],i,e)},"undefined"!=typeof Symbol&&Symbol.iterator&&(t.prototype[Symbol.iterator]=function(){return this.elements[Symbol.iterator]()}),r((function(s,e,i){t.apply(this,arguments),this.condition=i[1],this.body=i[2]}),t),r((function(s,e,i){t.apply(this,arguments),this.condition=i[1],this.body=i[2]}),t);var e=function(s,e,i){t.apply(this,arguments),this.body=i[1]};r(e,t),r((function(s,e,i){t.apply(this,arguments),this.not=i[0]}),t),r((function(s,e,i){t.apply(this,arguments),this.not=i[0],this.sprite=i[2],this.look_up_direction=i[3]}),t),r((function(s,e,i){t.apply(this,arguments),this.direction=i[1]}),t);var i={},h={_read_body(){var s=i,e=this._offset;this._cache._body=this._cache._body||{};var h=this._cache._body[e];if(h)return this._offset=h[1],h[0];for(var o=this._offset,r=[],n=null;;){var a=this._offset,f=new Array(1);if(this._read_ws()!==i){var _=i,c=this._offset;(_=this._read_turn())===i&&(this._offset=c,(_=this._read_move())===i&&(this._offset=c,(_=this._read_back())===i&&(this._offset=c,(_=this._read_shoot())===i&&(this._offset=c,(_=this._read_branch())===i&&(this._offset=c,(_=this._read_loop())===i&&(this._offset=c)))))),_!==i?(f[0]=_,this._read_ws()!==i&&this._read_nl()!==i||(f=null,this._offset=a)):(f=null,this._offset=a)}else f=null,this._offset=a;if(null===f?n=i:(n=new t(this._input.substring(a,this._offset),a,f),this._offset=this._offset),n===i)break;r.push(n)}return r.length>=0?(s=new t(this._input.substring(o,this._offset),o,r),this._offset=this._offset):s=i,this._cache._body[e]=[s,this._offset],s},_read_loop(){var s=i,e=this._offset;this._cache._loop=this._cache._loop||{};var h=this._cache._loop[e];if(h)return this._offset=h[1],h[0];var o,r=this._offset,n=new Array(3),a=i,f=null,_=this._offset+8;if(_<=this._inputSize&&(f=this._input.substring(this._offset,_)),"mientras"===f?(a=new t(this._input.substring(this._offset,this._offset+8),this._offset,[]),this._offset=this._offset+8):(a=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::loop","'mientras'"])),a!==i)if(n[0]=a,this._read_ws()!==i)if((o=this._read_condition())!==i)if(n[1]=o,this._read_ws()!==i){var c,l=i,u=null,p=this._offset+1;if(p<=this._inputSize&&(u=this._input.substring(this._offset,p)),"("===u?(l=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(l=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::loop","'('"])),l!==i)if(this._read_nl()!==i)if((c=this._read_body())!==i)if(n[2]=c,this._read_nl()!==i)if(this._read_ws()!==i){var d=i,g=null,m=this._offset+1;m<=this._inputSize&&(g=this._input.substring(this._offset,m)),")"===g?(d=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(d=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::loop","')'"])),d!==i||(n=null,this._offset=r)}else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r}else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r;return null===n?s=i:(s=this._actions.makeLoop(this._input,r,this._offset,n),this._offset=this._offset),this._cache._loop[e]=[s,this._offset],s},_read_branch(){var s=i,h=this._offset;this._cache._branch=this._cache._branch||{};var o=this._cache._branch[h];if(o)return this._offset=o[1],o[0];var r,n=this._offset,a=new Array(4),f=i,_=null,c=this._offset+2;if(c<=this._inputSize&&(_=this._input.substring(this._offset,c)),"si"===_?(f=new t(this._input.substring(this._offset,this._offset+2),this._offset,[]),this._offset=this._offset+2):(f=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","'si'"])),f!==i)if(a[0]=f,this._read_ws()!==i)if((r=this._read_condition())!==i)if(a[1]=r,this._read_ws()!==i){var l,u=i,p=null,d=this._offset+1;if(d<=this._inputSize&&(p=this._input.substring(this._offset,d)),"("===p?(u=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(u=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","'('"])),u!==i)if(this._read_nl()!==i)if((l=this._read_body())!==i)if(a[2]=l,this._read_nl()!==i)if(this._read_ws()!==i){var g=i,m=null,b=this._offset+1;if(b<=this._inputSize&&(m=this._input.substring(this._offset,b)),")"===m?(g=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(g=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","')'"])),g!==i){var y=i,v=this._offset,S=this._offset,w=new Array(2);if(this._read_ws()!==i){var x=i,k=null,L=this._offset+5;if(L<=this._inputSize&&(k=this._input.substring(this._offset,L)),"si no"===k?(x=new t(this._input.substring(this._offset,this._offset+5),this._offset,[]),this._offset=this._offset+5):(x=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","'si no'"])),x!==i)if(w[0]=x,this._read_ws()!==i){var P,T=i,z=null,E=this._offset+1;if(E<=this._inputSize&&(z=this._input.substring(this._offset,E)),"("===z?(T=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(T=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","'('"])),T!==i)if(this._read_nl()!==i)if((P=this._read_body())!==i)if(w[1]=P,this._read_nl()!==i)if(this._read_ws()!==i){var N=i,W=null,F=this._offset+1;F<=this._inputSize&&(W=this._input.substring(this._offset,F)),")"===W?(N=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(N=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::branch","')'"])),N!==i||(w=null,this._offset=S)}else w=null,this._offset=S;else w=null,this._offset=S;else w=null,this._offset=S;else w=null,this._offset=S;else w=null,this._offset=S}else w=null,this._offset=S;else w=null,this._offset=S}else w=null,this._offset=S;null===w?y=i:(y=new e(this._input.substring(S,this._offset),S,w),this._offset=this._offset),y===i&&(y=new t(this._input.substring(v,v),v,[]),this._offset=v),y!==i?a[3]=y:(a=null,this._offset=n)}else a=null,this._offset=n}else a=null,this._offset=n;else a=null,this._offset=n;else a=null,this._offset=n;else a=null,this._offset=n;else a=null,this._offset=n}else a=null,this._offset=n;else a=null,this._offset=n;else a=null,this._offset=n;else a=null,this._offset=n;return null===a?s=i:(s=this._actions.makeBranch(this._input,n,this._offset,a),this._offset=this._offset),this._cache._branch[h]=[s,this._offset],s},_read_condition(){var t=i,s=this._offset;this._cache._condition=this._cache._condition||{};var e=this._cache._condition[s];if(e)return this._offset=e[1],e[0];var h=this._offset;return(t=this._read_ahead_condition())===i&&(this._offset=h,(t=this._read_in_game_condition())===i&&(this._offset=h)),this._cache._condition[s]=[t,this._offset],t},_read_in_game_condition(){var s=i,e=this._offset;this._cache._in_game_condition=this._cache._in_game_condition||{};var h=this._cache._in_game_condition[e];if(h)return this._offset=h[1],h[0];var o,r=this._offset,n=new Array(2);if((o=this._read_not())!==i)if(n[0]=o,this._read_ws()!==i){var a=i,f=null,_=this._offset+11;_<=this._inputSize&&(f=this._input.substring(this._offset,_)),"haya salido"===f?(a=new t(this._input.substring(this._offset,this._offset+11),this._offset,[]),this._offset=this._offset+11):(a=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::in_game_condition","'haya salido'"])),a!==i?n[1]=a:(n=null,this._offset=r)}else n=null,this._offset=r;else n=null,this._offset=r;return null===n?s=i:(s=this._actions.makeInGameCondition(this._input,r,this._offset,n),this._offset=this._offset),this._cache._in_game_condition[e]=[s,this._offset],s},_read_ahead_condition(){var s=i,e=this._offset;this._cache._ahead_condition=this._cache._ahead_condition||{};var h=this._cache._ahead_condition[e];if(h)return this._offset=h[1],h[0];var o,r=this._offset,n=new Array(4);if((o=this._read_not())!==i)if(n[0]=o,this._read_ws()!==i){var a,f,_=i,c=null,l=this._offset+3;if(l<=this._inputSize&&(c=this._input.substring(this._offset,l)),"hay"===c?(_=new t(this._input.substring(this._offset,this._offset+3),this._offset,[]),this._offset=this._offset+3):(_=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::ahead_condition","'hay'"])),_!==i)if(n[1]=_,this._read_ws()!==i)if((a=this._read_sprite())!==i)if(n[2]=a,this._read_ws()!==i)(f=this._read_look_up_direction())!==i?n[3]=f:(n=null,this._offset=r);else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r;else n=null,this._offset=r}else n=null,this._offset=r;else n=null,this._offset=r;return null===n?s=i:(s=this._actions.makeLookAheadCondition(this._input,r,this._offset,n),this._offset=this._offset),this._cache._ahead_condition[e]=[s,this._offset],s},_read_not(){var s=i,e=this._offset;this._cache._not=this._cache._not||{};var h=this._cache._not[e];if(h)return this._offset=h[1],h[0];var o=this._offset,r=null,n=this._offset+2;return n<=this._inputSize&&(r=this._input.substring(this._offset,n)),"no"===r?(s=new t(this._input.substring(this._offset,this._offset+2),this._offset,[]),this._offset=this._offset+2):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::not","'no'"])),s===i&&(s=new t(this._input.substring(o,o),o,[]),this._offset=o),this._cache._not[e]=[s,this._offset],s},_read_sprite(){var s=i,e=this._offset;this._cache._sprite=this._cache._sprite||{};var h=this._cache._sprite[e];if(h)return this._offset=h[1],h[0];var o=this._offset,r=null,n=this._offset+5;if(n<=this._inputSize&&(r=this._input.substring(this._offset,n)),"pared"===r?(s=new t(this._input.substring(this._offset,this._offset+5),this._offset,[]),this._offset=this._offset+5):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::sprite","'pared'"])),s===i){this._offset=o;var a=null,f=this._offset+4;if(f<=this._inputSize&&(a=this._input.substring(this._offset,f)),"algo"===a?(s=new t(this._input.substring(this._offset,this._offset+4),this._offset,[]),this._offset=this._offset+4):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::sprite","'algo'"])),s===i){this._offset=o;var _=null,c=this._offset+6;if(c<=this._inputSize&&(_=this._input.substring(this._offset,c)),"zombie"===_?(s=new t(this._input.substring(this._offset,this._offset+6),this._offset,[]),this._offset=this._offset+6):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::sprite","'zombie'"])),s===i){this._offset=o;var l=null,u=this._offset+7;if(u<=this._inputSize&&(l=this._input.substring(this._offset,u)),"espacio"===l?(s=new t(this._input.substring(this._offset,this._offset+7),this._offset,[]),this._offset=this._offset+7):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::sprite","'espacio'"])),s===i){this._offset=o;var p=null,d=this._offset+6;d<=this._inputSize&&(p=this._input.substring(this._offset,d)),"salida"===p?(s=new t(this._input.substring(this._offset,this._offset+6),this._offset,[]),this._offset=this._offset+6):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::sprite","'salida'"])),s===i&&(this._offset=o)}}}}return this._cache._sprite[e]=[s,this._offset],s},_read_look_up_direction(){var s=i,e=this._offset;this._cache._look_up_direction=this._cache._look_up_direction||{};var h=this._cache._look_up_direction[e];if(h)return this._offset=h[1],h[0];var o=this._offset,r=null,n=this._offset+8;if(n<=this._inputSize&&(r=this._input.substring(this._offset,n)),"adelante"===r?(s=new t(this._input.substring(this._offset,this._offset+8),this._offset,[]),this._offset=this._offset+8):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::look_up_direction","'adelante'"])),s===i){this._offset=o;var a=null,f=this._offset+14;if(f<=this._inputSize&&(a=this._input.substring(this._offset,f)),"a la izquierda"===a?(s=new t(this._input.substring(this._offset,this._offset+14),this._offset,[]),this._offset=this._offset+14):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::look_up_direction","'a la izquierda'"])),s===i){this._offset=o;var _=null,c=this._offset+12;c<=this._inputSize&&(_=this._input.substring(this._offset,c)),"a la derecha"===_?(s=new t(this._input.substring(this._offset,this._offset+12),this._offset,[]),this._offset=this._offset+12):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::look_up_direction","'a la derecha'"])),s===i&&(this._offset=o)}}return this._cache._look_up_direction[e]=[s,this._offset],s},_read_move(){var t=i,s=this._offset;this._cache._move=this._cache._move||{};var e=this._cache._move[s];if(e)return this._offset=e[1],e[0];var h=null,o=this._offset+7;return o<=this._inputSize&&(h=this._input.substring(this._offset,o)),"avanzar"===h?(t=this._actions.makeMove(this._input,this._offset,this._offset+7,[]),this._offset=this._offset+7):(t=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::move","'avanzar'"])),this._cache._move[s]=[t,this._offset],t},_read_back(){var t=i,s=this._offset;this._cache._back=this._cache._back||{};var e=this._cache._back[s];if(e)return this._offset=e[1],e[0];var h=null,o=this._offset+10;return o<=this._inputSize&&(h=this._input.substring(this._offset,o)),"retroceder"===h?(t=this._actions.makeBack(this._input,this._offset,this._offset+10,[]),this._offset=this._offset+10):(t=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::back","'retroceder'"])),this._cache._back[s]=[t,this._offset],t},_read_shoot(){var t=i,s=this._offset;this._cache._shoot=this._cache._shoot||{};var e=this._cache._shoot[s];if(e)return this._offset=e[1],e[0];var h=null,o=this._offset+8;return o<=this._inputSize&&(h=this._input.substring(this._offset,o)),"disparar"===h?(t=this._actions.makeShoot(this._input,this._offset,this._offset+8,[]),this._offset=this._offset+8):(t=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::shoot","'disparar'"])),this._cache._shoot[s]=[t,this._offset],t},_read_turn(){var s=i,e=this._offset;this._cache._turn=this._cache._turn||{};var h=this._cache._turn[e];if(h)return this._offset=h[1],h[0];var o=this._offset,r=new Array(2),n=i,a=null,f=this._offset+5;if(f<=this._inputSize&&(a=this._input.substring(this._offset,f)),"girar"===a?(n=new t(this._input.substring(this._offset,this._offset+5),this._offset,[]),this._offset=this._offset+5):(n=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::turn","'girar'"])),n!==i)if(r[0]=n,this._read_ws()!==i){var _,c=i,l=null,u=this._offset+5;if(u<=this._inputSize&&(l=this._input.substring(this._offset,u)),"hacia"===l?(c=new t(this._input.substring(this._offset,this._offset+5),this._offset,[]),this._offset=this._offset+5):(c=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::turn","'hacia'"])),c!==i)if(this._read_ws()!==i)(_=this._read_direction())!==i?r[1]=_:(r=null,this._offset=o);else r=null,this._offset=o;else r=null,this._offset=o}else r=null,this._offset=o;else r=null,this._offset=o;return null===r?s=i:(s=this._actions.makeTurn(this._input,o,this._offset,r),this._offset=this._offset),this._cache._turn[e]=[s,this._offset],s},_read_direction(){var s=i,e=this._offset;this._cache._direction=this._cache._direction||{};var h=this._cache._direction[e];if(h)return this._offset=h[1],h[0];var o=this._offset,r=null,n=this._offset+12;if(n<=this._inputSize&&(r=this._input.substring(this._offset,n)),"la izquierda"===r?(s=new t(this._input.substring(this._offset,this._offset+12),this._offset,[]),this._offset=this._offset+12):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::direction","'la izquierda'"])),s===i){this._offset=o;var a=null,f=this._offset+10;if(f<=this._inputSize&&(a=this._input.substring(this._offset,f)),"la derecha"===a?(s=new t(this._input.substring(this._offset,this._offset+10),this._offset,[]),this._offset=this._offset+10):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::direction","'la derecha'"])),s===i){this._offset=o;var _=null,c=this._offset+5;c<=this._inputSize&&(_=this._input.substring(this._offset,c)),"atras"===_?(s=new t(this._input.substring(this._offset,this._offset+5),this._offset,[]),this._offset=this._offset+5):(s=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::direction","'atras'"])),s===i&&(this._offset=o)}}return this._cache._direction[e]=[s,this._offset],s},_read_ws(){var s=i,e=this._offset;this._cache._ws=this._cache._ws||{};var h=this._cache._ws[e];if(h)return this._offset=h[1],h[0];for(var o=this._offset,r=[],n=null;;){for(var a=this._offset,f=[],_=null;;){var c=null,l=this._offset+1;if(l<=this._inputSize&&(c=this._input.substring(this._offset,l)),null!==c&&/^[ \t]/.test(c)?(_=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(_=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::ws","[ \\t]"])),_===i)break;f.push(_)}if(f.length>=1?(n=new t(this._input.substring(a,this._offset),a,f),this._offset=this._offset):n=i,n===i)break;r.push(n)}return r.length>=0?(s=new t(this._input.substring(o,this._offset),o,r),this._offset=this._offset):s=i,this._cache._ws[e]=[s,this._offset],s},_read_nl(){var s=i,e=this._offset;this._cache._nl=this._cache._nl||{};var h=this._cache._nl[e];if(h)return this._offset=h[1],h[0];for(var o=this._offset,r=[],n=null;;){for(var a=this._offset,f=[],_=null;;){var c=null,l=this._offset+1;if(l<=this._inputSize&&(c=this._input.substring(this._offset,l)),null!==c&&/^[\r\n]/.test(c)?(_=new t(this._input.substring(this._offset,this._offset+1),this._offset,[]),this._offset=this._offset+1):(_=i,this._offset>this._failure&&(this._failure=this._offset,this._expected=[]),this._offset===this._failure&&this._expected.push(["SiDiLa::nl","[\\r\\n]"])),_===i)break;f.push(_)}if(f.length>=1?(n=new t(this._input.substring(a,this._offset),a,f),this._offset=this._offset):n=i,n===i)break;r.push(n)}return r.length>=0?(s=new t(this._input.substring(o,this._offset),o,r),this._offset=this._offset):s=i,this._cache._nl[e]=[s,this._offset],s}},o=function(t,s,e){this._input=t,this._inputSize=t.length,this._actions=s,this._types=e,this._offset=0,this._cache={},this._failure=0,this._expected=[]};function r(t,s){function e(){}e.prototype=s.prototype,t.prototype=new e,t.prototype.constructor=t}o.prototype.parse=function(){var t=this._read_body();if(t!==i&&this._offset===this._inputSize)return t;throw 0===this._expected.length&&(this._failure=this._offset,this._expected.push(["SiDiLa","<EOF>"])),this.constructor.lastError={offset:this._offset,expected:this._expected},new SyntaxError(function(t,s,e){for(var i=t.split(/\n/g),h=0,o=0;o<=s;)o+=i[h].length+1,h+=1;for(var r=i[h-1],n="Line "+h+": expected one of:\n\n",a=0;a<e.length;a++)n+="    - "+e[a][1]+" from "+e[a][0]+"\n";for(var f=h.toString();f.length<6;)f=" "+f;for(n+="\n"+f+" | "+r+"\n",o-=r.length+10;o<s;)n+=" ",o+=1;return n+"^"}(this._input,this._failure,this._expected))},Object.assign(o.prototype,h);var n={Grammar:h,Parser:o,parse:function(t,s){return new o(t,(s=s||{}).actions,s.types).parse()}};Object.assign(s,n)}()},862:t=>{"use strict";t.exports=JSON.parse('{"width":16,"height":16,"player":{"x":1,"y":1,"direction":"South"},"zombie":{"x":8,"y":1},"theme":{"image":"nes_tileset_cemetery.png","imageWidth":384,"imageHeight":128,"spriteWidth":16,"spriteHeight":16,"background":"#077704","sprite":{"north":186,"east":185,"south":184,"west":187,"dead":100,"nextNorth":0,"nextEast":0,"nextSouth":0,"nextWest":0,"zombie":164,"deadZombie":165},"animations":{}},"logic":{"0":"Exit","1":"Space","5":"Space","13":"Space","29":"Space","32":"Space","33":"Space","34":"Space","61":"Space","63":"Space","64":"Space","96":"Sphinx","99":"Sphinx","122":"Space","123":"Space","124":"Space","125":"Space","129":"Space","151":"Space","170":"Space","176":"Space","177":"Space"},"space":1,"map":[[25,26,27,27,27,27,27,27,27,27,27,27,27,27,27,28],[52,1,1,1,1,1,1,1,1,1,1,1,1,1,151,24],[52,1,1,1,1,1,1,89,1,1,1,1,151,151,1,24],[52,1,151,151,1,124,101,113,102,103,100,124,124,1,1,24],[52,1,1,1,125,126,144,144,144,144,144,144,145,177,1,24],[36,11,11,1,125,42,43,43,43,174,174,174,45,177,1,24],[36,37,37,1,1,64,64,64,34,14,174,128,129,1,1,24],[62,63,63,1,1,1,1,151,170,14,174,128,177,151,151,24],[52,1,1,1,1,49,51,1,170,14,174,128,177,151,70,24],[52,30,31,1,1,73,75,1,86,171,174,175,177,151,71,111],[52,53,54,1,1,122,122,170,126,106,106,175,177,151,151,111],[52,122,122,1,1,51,1,170,42,106,106,175,177,1,1,24],[52,1,1,1,49,78,1,1,34,42,44,45,177,1,1,24],[52,1,96,1,73,98,102,103,101,64,64,64,1,1,151,24],[52,1,99,1,122,122,122,122,122,1,1,1,1,1,1,24],[148,149,149,149,140,140,140,149,149,149,138,150,0,168,149,141]]}')},37:t=>{"use strict";t.exports=JSON.parse('{"width":16,"height":16,"player":{"x":12,"y":2,"direction":"South"},"zombie":{"x":6,"y":7},"theme":{"image":"dungeon.png","imageWidth":384,"imageHeight":160,"spriteWidth":16,"spriteHeight":16,"background":"#91b09a","sprite":{"north":189,"east":189,"south":189,"west":189,"dead":165,"nextNorth":212,"nextEast":213,"nextSouth":237,"nextWest":236,"zombie":188,"deadZombie":164},"animations":{"11,0":{"type":"two-ways","settings":{"sprites":[204,201,198,195,192],"period":75,"subscribe":"game-started"}},"11,1":{"type":"two-ways","settings":{"sprites":[228,225,222,219,216],"period":75,"subscribe":"game-started"}},"12,0":{"type":"two-ways","settings":{"sprites":[205,202,199,196,193],"period":75,"subscribe":"game-started"}},"12,1":{"type":"two-ways","settings":{"sprites":[229,226,223,220,217],"period":75,"subscribe":"game-started"}},"13,0":{"type":"two-ways","settings":{"sprites":[206,203,200,197,194],"period":75,"subscribe":"game-started"}},"13,1":{"type":"two-ways","settings":{"sprites":[230,227,224,221,218],"period":75,"subscribe":"game-started"}},"7,13":{"type":"loop","settings":{"sprites":[157,158],"period":300}},"13,12":{"type":"two-ways","settings":{"sprites":[175,174,173,172],"period":100}}}},"logic":{"54":"Space","172":"Exit","173":"Exit","174":"Exit","175":"Exit","190":"Sphinx"},"space":54,"map":[[5,6,6,6,6,104,6,6,6,6,6,204,205,206,6,7],[29,30,30,147,30,128,30,30,168,30,30,228,229,230,30,31],[53,184,186,54,54,54,54,54,54,54,54,54,54,54,54,55],[102,54,54,54,54,54,54,54,209,210,54,54,54,54,54,75],[76,54,182,54,54,54,54,54,233,234,54,54,54,54,54,99],[100,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[102,54,54,54,54,54,54,54,54,54,8,78,78,127,78,4],[53,54,54,54,54,54,54,54,54,182,99,25,25,25,25,25],[76,54,54,54,54,54,54,54,182,182,55,25,25,25,25,25],[100,54,54,54,54,190,54,54,54,54,56,6,6,6,6,7],[53,54,54,54,54,54,54,54,54,54,80,171,30,175,30,31],[53,54,54,54,54,54,54,158,54,54,54,54,54,54,54,55],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[77,78,78,78,127,78,78,78,78,78,127,78,78,78,78,79]]}')},679:t=>{"use strict";t.exports=JSON.parse('{"width":16,"height":16,"player":{"x":7,"y":2,"direction":"South"},"zombie":{"x":9,"y":9},"theme":{"image":"dungeon.png","imageWidth":384,"imageHeight":160,"spriteWidth":16,"spriteHeight":16,"background":"#91b09a","sprite":{"north":189,"east":189,"south":189,"west":189,"dead":165,"nextNorth":212,"nextEast":213,"nextSouth":237,"nextWest":236,"zombie":188,"deadZombie":164},"animations":{"3,5":{"type":"loop","settings":{"sprites":[34,36,38,40,42],"period":120}},"4,5":{"type":"loop","settings":{"sprites":[35,37,39,41,43],"period":120}},"7,12":{"type":"two-ways","settings":{"sprites":[175,174,173,172],"period":100}}}},"logic":{"54":"Space","172":"Exit","173":"Exit","174":"Exit","175":"Exit","190":"Sphinx"},"space":54,"map":[[5,6,6,6,6,104,6,6,6,6,104,105,6,6,6,7],[29,30,30,30,30,128,30,148,30,30,128,129,30,30,30,31],[53,54,54,54,54,54,54,54,182,182,54,54,54,185,183,55],[102,54,54,54,54,54,54,54,182,54,54,54,54,54,186,75],[76,54,54,18,19,54,54,54,182,182,54,54,54,54,54,99],[100,54,54,34,35,54,54,54,182,54,54,54,54,54,54,55],[53,54,54,66,67,54,54,182,54,54,54,54,54,54,54,55],[53,54,54,54,54,54,54,54,54,54,207,208,54,54,54,55],[102,54,54,54,54,54,54,54,54,54,231,232,54,8,78,4],[53,54,54,54,8,78,78,127,9,54,54,54,54,32,25,25],[76,54,54,54,32,25,25,25,33,54,54,54,54,55,25,25],[100,54,54,54,56,6,6,6,57,54,54,54,54,56,6,7],[53,54,54,54,80,30,30,175,81,54,54,54,54,80,30,31],[53,54,54,54,190,54,54,54,54,54,54,54,54,54,186,55],[53,186,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[77,78,78,78,127,78,78,78,78,78,127,78,78,78,78,79]]}')},715:t=>{"use strict";t.exports=JSON.parse('{"width":16,"height":16,"player":{"x":13,"y":13,"direction":"West"},"zombie":{"x":3,"y":9},"theme":{"image":"dungeon.png","imageWidth":384,"imageHeight":160,"spriteWidth":16,"spriteHeight":16,"background":"#91b09a","sprite":{"north":189,"east":189,"south":189,"west":189,"dead":165,"nextNorth":212,"nextEast":213,"nextSouth":237,"nextWest":236,"zombie":188,"deadZombie":164},"animations":{"12,11":{"type":"two-ways","settings":{"sprites":[204,201,198,195,192],"period":75,"subscribe":"game-started"}},"12,12":{"type":"two-ways","settings":{"sprites":[228,225,222,219,216],"period":75,"subscribe":"game-started"}},"13,11":{"type":"two-ways","settings":{"sprites":[205,202,199,196,193],"period":75,"subscribe":"game-started"}},"13,12":{"type":"two-ways","settings":{"sprites":[229,226,223,220,217],"period":75,"subscribe":"game-started"}},"14,11":{"type":"two-ways","settings":{"sprites":[206,203,200,197,194],"period":75,"subscribe":"game-started"}},"14,12":{"type":"two-ways","settings":{"sprites":[230,227,224,221,218],"period":75,"subscribe":"game-started"}},"7,1":{"type":"two-ways","settings":{"sprites":[175,174,173,172],"period":100}}}},"logic":{"54":"Space","172":"Exit","173":"Exit","174":"Exit","175":"Exit","190":"Sphinx"},"space":54,"map":[[5,6,6,6,6,104,6,6,6,6,104,105,6,6,6,7],[29,30,30,30,30,128,30,175,30,30,128,129,30,30,30,31],[53,182,182,54,54,54,54,54,182,182,54,54,54,185,183,55],[102,54,54,54,54,54,54,54,54,54,54,54,54,54,186,75],[76,54,54,8,78,78,78,9,54,54,190,54,54,54,54,99],[100,54,54,32,25,25,25,33,54,54,54,54,54,54,54,55],[53,54,54,56,6,6,105,57,54,54,54,54,54,54,54,55],[53,54,54,80,30,30,129,81,54,54,54,54,54,54,54,55],[102,54,54,54,209,210,54,54,54,54,54,8,78,78,78,4],[53,54,54,54,233,234,54,54,54,54,54,32,25,25,25,25],[76,54,54,54,54,54,54,54,54,54,54,55,25,25,25,25],[100,54,54,54,54,54,54,54,54,54,54,56,192,193,194,7],[53,54,54,54,54,54,54,54,54,54,54,80,216,217,218,31],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[77,78,78,78,127,78,78,78,78,78,127,78,78,78,78,79]]}')},387:t=>{"use strict";t.exports=JSON.parse('{"width":16,"height":16,"player":{"x":14,"y":14,"direction":"West"},"zombie":{"x":1,"y":13},"theme":{"image":"dungeon.png","imageWidth":384,"imageHeight":160,"spriteWidth":16,"spriteHeight":16,"background":"#91b09a","sprite":{"north":189,"east":189,"south":189,"west":189,"dead":165,"nextNorth":212,"nextEast":213,"nextSouth":237,"nextWest":236,"zombie":188,"deadZombie":164},"animations":{"14,13":{"type":"two-ways","settings":{"sprites":[144,145,146,147,148],"period":75,"subscribe":"game-started"}},"7,1":{"type":"two-ways","settings":{"sprites":[175,174,173,172],"period":100}}}},"logic":{"54":"Space","172":"Exit","173":"Exit","174":"Exit","175":"Exit","190":"Sphinx"},"space":54,"map":[[5,6,6,6,6,104,6,6,6,6,104,105,6,6,6,7],[29,30,30,30,30,128,30,175,30,30,128,129,30,30,30,31],[53,182,182,54,54,54,54,54,54,190,54,54,54,54,54,55],[102,54,182,54,54,54,54,54,54,54,54,54,8,9,54,75],[76,54,54,8,78,78,78,9,54,54,54,54,32,33,54,99],[100,54,54,32,25,25,25,77,78,78,78,78,79,53,54,55],[77,9,54,56,6,6,105,7,25,25,5,6,6,57,54,55],[5,57,54,80,30,30,129,31,25,25,29,30,30,81,54,55],[29,81,54,54,209,210,54,55,5,6,57,54,54,54,54,55],[53,54,54,54,233,234,54,75,29,30,81,54,8,78,78,79],[76,54,8,78,78,9,54,99,53,54,54,54,32,25,25,25],[100,54,55,25,25,53,54,55,53,54,8,78,79,25,25,25],[53,54,56,6,6,57,54,56,57,54,56,6,6,6,6,7],[53,54,80,30,30,81,54,80,81,54,80,30,30,30,144,31],[53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,55],[77,78,78,78,127,78,78,78,78,78,127,78,78,78,78,79]]}')}},s={};function e(i){var h=s[i];if(void 0!==h)return h.exports;var o=s[i]={exports:{}};return t[i](o,o.exports,e),o.exports}e.d=(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},e.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";e.r(i),e.d(i,{CanvasPainter:()=>S,CodeMirrorHelper:()=>q,Control:()=>H,EditorBoard:()=>y,GameBoard:()=>m,GameResult:()=>g,PalettePainter:()=>w,ProgramListDropDownHandler:()=>j,Storage:()=>L,parse:()=>G});class t{constructor(t,s){this.width=t,this.height=s,this.maxIndex=t*s-1}getSlotIndexFor(t,s){if(t>this.width-1||s>this.height-1)throw new Error(`Coordinates out of bound: ${t},${s}`);return t+s*this.width}getCoordinatesFor(t){if(t>this.maxIndex)throw new Error(`Index out of bound: ${t}`);return{x:t%this.width,y:Math.floor(t/this.width)}}}class s{constructor(t,e){this.animations={};for(const i in t)Object.hasOwnProperty.call(t,i)&&(this.animations[i]=s.createAnimationFromSettings(t[i],e))}getSprite(t,s,e){return this.getAnimationAt(t,s)?.getSprite(e)}getAnimationAt(t,s){const e=`${t},${s}`;if(Object.hasOwnProperty.call(this.animations,e))return this.animations[e]}trigger(t,s){const e=this.getAnimationAt(t,s);void 0!==e&&e instanceof o&&e.launch()}static createAnimationFromSettings(t,s){switch(t.type){case"loop":return new h(t.settings,s);case"two-ways":return new o(t.settings,s)}}}class h{constructor(t,s){this.settings=t,this.loopLimit=t.sprites.length*t.period}getSprite(t){return this.advanceTime(t),this.settings.sprites[this.getIndexForCurrentTimestamp()]}advanceTime(t){this.currentTimestamp=t}getIndexForCurrentTimestamp(){return Math.floor(this.currentTimestamp/this.settings.period)%this.settings.sprites.length}}class o{constructor(t,s){this.baseAnimation=new h(t),this.alternateTimestamp=0,this.animationRunning=!1,this.animationForward=!0,void 0!==t.subscribe&&s.subscribe(t.subscribe,(()=>this.launch()))}launch(){this.animationRunning=!0}getSprite(t){return this.advanceTime(t),this.baseAnimation.getSprite(this.alternateTimestamp)}getDelta(t){if(void 0===this.previousTimestamp)return this.previousTimestamp=t,0;const s=t-this.previousTimestamp;return this.previousTimestamp=t,s}advanceTime(t){this.animationRunning&&(this.animationForward?this.alternateTimestamp+=this.getDelta(t):this.alternateTimestamp-=this.getDelta(t),this.alternateTimestamp<0?(this.alternateTimestamp=0,this.animationRunning=!1,this.animationForward=!0,this.previousTimestamp=void 0):this.alternateTimestamp>=this.baseAnimation.loopLimit&&(this.alternateTimestamp=this.baseAnimation.loopLimit-1,this.animationRunning=!1,this.animationForward=!1,this.previousTimestamp=void 0))}}class r{static GameReset=new r("game-reset");static GameStarted=new r("game-started");static GameFinished=new r("game-finished");static PlayerMoved=new r("player-moved");static PlayerDied=new r("player-died");static PlayerWon=new r("player-won");static PlayerShot=new r("player-shot");static InterpreterStep=new r("interpreter-step");static Score=new r("game-score");constructor(t){this.channelName=t}}class n{static Wall=new n("█");static Exit=new n("░");static Space=new n(" ");static Zombie=new n("👾");static Sphinx=new n("💀");static Null=new n("X");constructor(t){this.symbol=t}}class a{static North=new a("▲",(t=>({x:t.x,y:t.y-1})),(t=>({x:t.x,y:t.y+1})));static East=new a("▶",(t=>({x:t.x+1,y:t.y})),(t=>({x:t.x-1,y:t.y})));static South=new a("▼",(t=>({x:t.x,y:t.y+1})),(t=>({x:t.x,y:t.y-1})));static West=new a("◀",(t=>({x:t.x-1,y:t.y})),(t=>({x:t.x+1,y:t.y})));constructor(t,s,e){this.symbol=t,this.advancePosition=s,this.retreatPosition=e}advance(t){return this.advancePosition(t)}retreat(t){return this.retreatPosition(t)}static order=[this.North,this.East,this.South,this.West];static toTheRight(t){const s=this.order.indexOf(t)+1;return this.order[s%4]}static toTheLeft(t){const s=this.order.indexOf(t)-1;return this.order[s>-1?s:3]}static backwards(t){const s=this.order.indexOf(t)+2;return this.order[s%4]}}class f{static Forth=new f(((t,s)=>t.advance(s)));static Back=new f(((t,s)=>t.retreat(s)));constructor(t){this.apply=t}}class _{constructor(t,s,e){this.x=t,this.y=s,this.direction=e,this.crashed=!1}isAt(t,s){return this.x==t&&this.y==s}move(t){const s=t.apply(this.direction,this);this.x=s.x,this.y=s.y}wouldMove(t){return t.apply(this.direction,this)}wouldMoveTo(t,s,e){const i=this.wouldMove(t);return i.x===s&&i.y===e}rotateLeft(){this.direction=a.toTheLeft(this.direction)}rotateRight(){this.direction=a.toTheRight(this.direction)}rotateBack(){this.direction=a.backwards(this.direction)}crash(){this.crashed=!0}}class c extends _{constructor(t,s,e){super(t,s,e),this.sprite=null,this.dead=null}setupSprites(t){this.sprite=t.sprite.zombie,this.dead=t.sprite.deadZombie}getSprite(){return this.crashed?this.dead:this.sprite}}class l extends _{constructor(t,s,e){super(t,s,e),this.done=!1}setupSprites(t){a.North.sprite=t.sprite.north,a.East.sprite=t.sprite.east,a.South.sprite=t.sprite.south,a.West.sprite=t.sprite.west,a.North.arrowSprite=t.sprite.nextNorth,a.East.arrowSprite=t.sprite.nextEast,a.South.arrowSprite=t.sprite.nextSouth,a.West.arrowSprite=t.sprite.nextWest,this.deadSprite=t.sprite.dead}subscribeToEvents(t){t.subscribe(r.PlayerDied.channelName,(()=>this.crash())),t.subscribe(r.PlayerWon.channelName,(()=>this.finish()))}getSprite(){return this.crashed?this.deadSprite:this.done?null:this.direction.sprite}getNextMoveSprite(){return this.crashed||this.done?null:this.direction.arrowSprite}getShootTarget(){return this.direction.advance(this)}finish(){this.done=!0}getLeftPosition(){const t=a.toTheLeft(this.direction);return f.Forth.apply(t,this)}getRightPosition(){const t=a.toTheRight(this.direction);return f.Forth.apply(t,this)}}class u{constructor(t){this.eventBus=t}loadScene(e){this.scene=e,this.gridCoordinatesTranslator=new t(this.scene.width,this.scene.height),this.animationService=new s(this.scene.theme.animations,this.eventBus)}getSprite(t,s,e){const i=this.animationService.getSprite(t,s,e);return void 0!==i?i:this.scene.map[s][t]}getLogicLabelForSprite(t){return this.scene.logic[t]}getLogic(t,s){const e=this.getLogicLabelForSprite(this.getSprite(t,s));return void 0===e?n.Wall:n[e]}getSlotIndexFor(t,s){return this.gridCoordinatesTranslator.getSlotIndexFor(t,s)}getCoordinatesFor(t){return this.gridCoordinatesTranslator.getCoordinatesFor(t)}}class p{constructor(t){this.sound=document.createElement("audio"),this.sound.src=`/sidila/snd//${t}`}play(){this.sound.play()}pause(){this.sound.pause()}}class d{constructor(){this.scenes=[e(37),e(679),e(715),e(387),e(862)]}get(t){return this.scenes[t]}getSceneCount(){return this.scenes.length}}class g{static NotFinished=new g;static Won=new g;static Died=new g}class m extends u{constructor(t){super(t),this.sceneService=new d,this.soundOn=!0,this.soundMap={step:new p("step.ogg"),bang:new p("bang.ogg"),win:new p("win.ogg"),gameOver:new p("gameover.ogg")},this.subscribeToEvents(),this.reset(0)}subscribeToEvents(){this.eventBus.subscribe(r.PlayerMoved.channelName,(()=>this.playSound(this.soundMap.step))),this.eventBus.subscribe(r.PlayerShot.channelName,(()=>this.playSound(this.soundMap.bang))),this.eventBus.subscribe(r.PlayerDied.channelName,(()=>this.playSound(this.soundMap.gameOver))),this.eventBus.subscribe(r.PlayerWon.channelName,(t=>{this.animationService.trigger(t.x,t.y),this.playSound(this.soundMap.win)}))}reset(t){const s=this.sceneService.get(t);this.loadScene(s),this.player=new l(this.scene.player.x,this.scene.player.y,a[this.scene.player.direction]),this.player.subscribeToEvents(this.eventBus),this.zombie=new c(this.scene.zombie.x,this.scene.zombie.y,a.North),this.player.setupSprites(this.scene.theme),this.zombie.setupSprites(this.scene.theme),this.gameResult=g.NotFinished,this.moves=0,this.shots=0,this.publishNoDataEvent(r.GameReset)}getSceneCount(){return this.sceneService.getSceneCount()}canMoveInto(t,s){const e=this.getLogic(t,s);return e===n.Space||e===n.Exit}isCrashed(){return this.player.crashed}isDone(){return this.player.done}start(){this.publishNoDataEvent(r.GameStarted)}movePlayer(t){this.publishPlayerMoved(t);const s=this.player.wouldMove(t);this.canMoveInto(s.x,s.y)?(this.player.move(t),this.getLogicAround(this.player.x,this.player.y).includes(n.Sphinx)&&this.killPlayer(),this.getLogic(this.player.x,this.player.y)===n.Exit&&this.exitPlayer()):this.killPlayer(),this.moves++,(this.player.crashed||this.player.done)&&this.publishGameFinished()}rotatePlayerLeft(){this.player.rotateLeft()}rotatePlayerRight(){this.player.rotateRight()}rotatePlayerBack(){this.player.rotateBack()}playerShoot(){this.publishNoDataEvent(r.PlayerShot);const t=this.player.getShootTarget();this.getLogic(t.x,t.y)===n.Zombie&&this.zombie.crash(),this.shots++}killPlayer(){this.publishPlayerDied(),this.gameResult=g.Died}exitPlayer(){this.publishPlayerWon({x:this.player.x,y:this.player.y}),this.gameResult=g.Won}getLogic(t,s){return t<0||s<0||t>this.scene.width-1||s>this.scene.height-1?n.Null:this.zombie?.isAt(t,s)&&!0!==this.zombie?.crashed?n.Zombie:super.getLogic(t,s)}getLogicAround(t,s){return[this.getLogic(t,s-1),this.getLogic(t,s+1),this.getLogic(t-1,s),this.getLogic(t+1,s)]}getLogicInFrontOfPlayer(){const t=this.player.wouldMove(f.Forth);return this.getLogic(t.x,t.y)}getLogicToTheLeftOfPlayer(){const t=this.player.getLeftPosition();return this.getLogic(t.x,t.y)}getLogicToTheRightOfPlayer(){const t=this.player.getRightPosition();return this.getLogic(t.x,t.y)}getOverlaySprite(t,s,e){return this.player.isAt(t,s)?this.player.getSprite():this.zombie?.isAt(t,s)?this.zombie.getSprite():this.player.wouldMoveTo(f.Forth,t,s)?this.player.getNextMoveSprite():null}setSound(t){this.soundOn=t}playSound(t){this.soundOn&&t.play()}publishPlayerMoved(t){this.eventBus.publish(r.PlayerMoved.channelName,t)}publishPlayerDied(){this.eventBus.publish(r.PlayerDied.channelName,null)}publishPlayerWon(t){this.eventBus.publish(r.PlayerWon.channelName,t)}publishGameFinished(){this.eventBus.publish(r.GameFinished.channelName,this.gameResult)}publishNoDataEvent(t){this.eventBus.publish(t.channelName,null)}}class b{constructor(){this.subscribers={}}subscribe(t,s){Object.hasOwnProperty.call(this.subscribers,t)||(this.subscribers[t]=[]),this.subscribers[t].push(s)}unsubscribe(t,s){Object.hasOwnProperty.call(this.subscribers,t)&&this.subscribers[t].splice(this.subscribers[t].indexOf(s),1)}publish(t,s){Object.hasOwnProperty.call(this.subscribers,t)&&this.subscribers[t].forEach((t=>{t(s)}))}}class y extends u{constructor(){super(new b),this.undo=[]}load(t){const s=JSON.parse(t);this.loadScene(s)}save(){return JSON.stringify(this.scene,null,2)}setSlot(t,s){const e=this.getCoordinatesFor(t);if(this.scene.map[e.y][e.x]!=s){const t=this.scene.map[e.y][e.x];this.addUndo((()=>this.scene.map[e.y][e.x]=t)),this.scene.map[e.y][e.x]=s}}addUndo(t){this.undo.push(t),this.undo.length>100&&this.undo.pop()}undoLastAction(){const t=this.undo.pop();void 0!==t&&t()}getOverlaySprite(t,s){return null}}class v{constructor(t,s,e,i,h,o){this.canvas=t,this.width=s,this.height=e,this.slotWidth=i,this.slotHeight=h,this.slotsInX=Math.floor(this.width/this.slotWidth),this.slotsInY=Math.floor(this.height/this.slotHeight),this.hoverColor=o,this.scaleX=t.clientWidth/this.width,this.scaleY=t.clientHeight/this.height}getContext2D(){return this.canvas.getContext("2d")}mouseOver(t,s){return this.hover=this.getSlotIndexForDiscrete(Math.floor(t/this.scaleX/this.slotWidth),Math.floor(s/this.scaleY/this.slotHeight)),this.hover}getSlotIndexForDiscrete(t,s){return t+s*this.slotsInX}getCanvasCoordinatesForSlot(t){const s=this.getCoordinatesForSlot(t);return{x:s.x*this.slotWidth,y:s.y*this.slotHeight}}getCoordinatesForSlot(t){return{x:t%this.slotsInX,y:Math.floor(t/this.slotsInX)}}drawGridSlot(t,s,e){t.strokeStyle=e,t.strokeRect(s.x+.5,s.y+.5,this.slotWidth-1,this.slotHeight-1)}paintHover(t){if(void 0!==this.hover){const s=this.getCanvasCoordinatesForSlot(this.hover);this.drawGridSlot(t,s,this.hoverColor)}}}class S extends v{constructor(t,s,e){super(t,s.scene.width*s.scene.theme.spriteWidth,s.scene.height*s.scene.theme.spriteHeight,s.scene.theme.spriteWidth,s.scene.theme.spriteHeight,"red"),this.board=s,this.eventBus=e,this.sceneUpdated(),void 0!==this.eventBus&&this.subscribeToEvents()}subscribeToEvents(){this.eventBus.subscribe(r.GameReset.channelName,(()=>this.sceneUpdated()))}sceneUpdated(){this.sprites=new Image,this.sprites.src=`/sidila/img/${this.board.scene.theme.image}`}paint(t){const s=this.getContext2D();s.fillStyle=this.board.scene.theme.background,s.fillRect(0,0,this.canvas.width,this.canvas.height);for(let e=0;e<this.slotsInY;e++)for(let i=0;i<this.slotsInX;i++){const h=this.board.getSprite(i,e,t);this.drawSprite(s,h,i,e);const o=this.board.getOverlaySprite(i,e,t);null!=o&&this.drawSprite(s,o,i,e)}this.paintHover(s)}drawSprite(t,s,e,i){const h=this.getSourceX(s),o=this.getSourceY(s);t.drawImage(this.sprites,h,o,this.slotWidth,this.slotHeight,e*this.slotWidth,i*this.slotHeight,this.slotWidth,this.slotHeight)}getSourceX(t){return this.slotWidth*(t%(this.sprites.width/this.slotWidth))}getSourceY(t){return this.slotHeight*Math.floor(t/(this.sprites.width/this.slotWidth))}}class w extends v{constructor(t,s){super(t,s.theme.imageWidth,s.theme.imageHeight,s.theme.spriteWidth,s.theme.spriteHeight,"red"),this.scene=s,this.sprites=new Image,this.sprites.src=`/sidila/img/${s.theme.image}`,this.selected=0}paint(){const t=this.getContext2D();if(t.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.sprites,0,0),void 0!==this.selected){const s=this.getCanvasCoordinatesForSlot(this.selected);this.drawGridSlot(t,s,"white")}this.paintHover(t)}selectSlot(t){this.selected=t}}const x="sidila-program-",k=/\w{2,20}/g;class L{static requireValidProgramName(t){if(!t.match(k))throw new Error("Nombre de programa inválido")}listSavedPrograms(){const t=[];for(let s=0,e=localStorage.length;s<e;++s)localStorage.key(s).startsWith(x)&&t.push(L.getFilenameFromKey(localStorage.key(s)));return t}loadProgram(t){L.requireValidProgramName(t);const s=L.getKeyFromFilename(t);if(null!=s&&""!=s)return localStorage.getItem(s)}saveProgram(t,s,e){L.requireValidProgramName(t);const i=L.getKeyFromFilename(t);if(null!==localStorage.getItem(i)&&!e.checked)throw new Error("Ya existe un programa con ese nombre");localStorage.setItem(i,s)}deleteProgram(t){L.requireValidProgramName(t);const s=L.getKeyFromFilename(t);localStorage.removeItem(s)}static getKeyFromFilename(t){return x+t}static getFilenameFromKey(t){return t.substring(x.length,t.length)}}class P{constructor(){this.base=2e5}getScore(t,s){if(s.isCrashed())return 0;const e=s.zombie.crashed,i=e?.96:1,h=s.moves,o=e?.91:1,r=s.shots,n=e?.73:1;return Math.ceil(this.base-3002*t*i-996*h*o-603*r*n)}}class T{constructor(t,s){this.location={start:t,end:s}}}class z extends T{constructor(t,s){super(t,s)}}class E extends z{constructor(t,s){super(t,s)}execute(t){t.movePlayer(f.Forth)}}class N extends z{constructor(t,s){super(t,s)}execute(t){t.movePlayer(f.Back)}}class W extends z{constructor(t,s){super(t,s)}execute(t){t.playerShoot()}}class F{static Left=new F((t=>t.rotatePlayerLeft()));static Right=new F((t=>t.rotatePlayerRight()));static Back=new F((t=>t.rotatePlayerBack()));constructor(t){this.action=t}}class D extends z{constructor(t,s,e){switch(super(t,s),e){case"la derecha":this.direction=F.Right;break;case"la izquierda":this.direction=F.Left;break;case"atras":this.direction=F.Back;break;default:throw new Error(`Invalid direction: '${e}'`)}}execute(t){this.direction.action(t)}}class M extends T{constructor(t,s,e,i,h){super(t,s),this.condition=e,this.body=i,this.elseBody=h}evaluate(t){return this.condition.evaluate(t)}}class B extends T{constructor(t,s,e,i){super(t,s),this.condition=e,this.body=i}evaluate(t){return this.condition.evaluate(t)}}class O extends T{constructor(t,s,e,i,h){super(t,s),this.not="no"===e,this.condition="pared"===i?t=>t===n.Wall:"zombie"===i?t=>t===n.Zombie:"espacio"===i?t=>t===n.Space:"salida"===i?t=>t===n.Exit:t=>t!==n.Space,this.lookUpDirection="adelante"==h?t=>t.getLogicInFrontOfPlayer():"a la izquierda"==h?t=>t.getLogicToTheLeftOfPlayer():t=>t.getLogicToTheRightOfPlayer()}evaluate(t){const s=this.condition(this.lookUpDirection(t));return this.not?!s:s}}class I extends T{constructor(t,s,e){super(t,s),this.not="no"===e}evaluate(t){const s=t.isDone();return this.not?!s:s}}class C{constructor(t,s,e){this.eventBus=e,this.board=t,this.tree=s,this.stack=[],this.stackBody(this.tree.elements),this.gameTicks=0,this.finished=!1}stackBody(t){for(let s=t.length-1;s>=0;s--)this.stackNode(t[s])}stackNode(t){this.stack.push(t)}tick(){this.gameTicks++;const t=this.stack.pop();void 0!==t&&this.visitNode(t),this.finished=0===this.stack.length}isFinished(){return this.finished}visitNode(t){const s=t.elements[0];this.publishStep(s),s instanceof z?s.execute(this.board):s instanceof M?s.evaluate(this.board)?this.stackBody(s.body):void 0!==s.elseBody&&this.stackBody(s.elseBody):s instanceof B&&s.evaluate(this.board)&&(this.stackNode(t),this.stackBody(s.body))}createStepEvent(t){return{location:t.location,gameTicks:this.gameTicks}}publishStep(t){const s=this.createStepEvent(t);this.eventBus.publish(r.InterpreterStep.channelName,s)}subscribeToStep(t){this.eventBus.subscribe(r.InterpreterStep.channelName,t)}}class H{constructor(t,s){this.codeMirror=t,this.eventBus=new b,this.board=new m(this.eventBus),this.canvasPainter=new S(s,this.board,this.eventBus),this.score=new P,this.running=!1,this.subscribeToEvents()}subscribeToEvents(){this.eventBus.subscribe(r.GameFinished.channelName,(()=>this.running=!1)),this.codeMirror.on("changes",(()=>this.publishScore()))}run(t){this.interpreter=new C(this.board,t,this.eventBus),this.board.start(),this.running=!0}isRunning(){return this.running}tick(){this.interpreter.tick(),this.interpreter.isFinished()&&(this.running=!1),this.publishScore()}paint(t){this.canvasPainter.paint(t)}publishScore(){const t=this.codeMirror.lineCount(),s=this.score.getScore(t,this.board);this.eventBus.publish(r.Score.channelName,s)}reset(t){this.board.reset(t),this.running=!1}subscribeToStep(t){this.eventBus.subscribe(r.InterpreterStep.channelName,t)}subscribeToScore(t){this.eventBus.subscribe(r.Score.channelName,t)}subscribeToGameFinished(t){this.eventBus.subscribe(r.GameFinished.channelName,t)}setSound(t){this.board.setSound(t)}}const R=e(498);class A{makeMove(t,s,e,i){return new E(s,e)}makeBack(t,s,e,i){return new N(s,e)}makeShoot(t,s,e,i){return new W(s,e)}makeTurn(t,s,e,i){return new D(s,e,i[1].text)}makeBranch(t,s,e,i){const h=i[1],o=i[2].elements,r=i[3].elements[1]?.elements;return new M(s,e,h,o,r)}makeLoop(t,s,e,i){const h=i[1],o=i[2].elements;return new B(s,e,h,o)}makeLookAheadCondition(t,s,e,i){const h=i[0].text,o=i[2].text,r=i[3].text;return new O(s,e,h,o,r)}makeInGameCondition(t,s,e,i){return new I(s,e,i[0].text)}}function G(t){return R.parse(t,{actions:new A})}class j{constructor(t,s){this.storage=t,this.selectWidget=s}loadFiles(){this.emptySelectWidget(),this.storage.listSavedPrograms().forEach((t=>{const s=document.createElement("option");s.text=t,s.value=t,this.selectWidget.add(s)}))}emptySelectWidget(){const t=[].filter.call(this.selectWidget.options,(t=>""===t.value))[0];for(;this.selectWidget.length>0;)this.selectWidget.remove(this.selectWidget.length-1);this.selectWidget.add(t)}getSelectedProgram(){const t=this.selectWidget.options[this.selectWidget.selectedIndex].value;return this.storage.loadProgram(t)}}class q{constructor(t,s,e){this.codeMirror=t,this.debugClassName=s,this.errorClassName=e}highlight(t){const s=this.codeMirror.posFromIndex(t.start),e=this.codeMirror.posFromIndex(t.end);this.clearHighlight(),this.lastHighlightMarker=this.codeMirror.markText(s,e,{className:this.debugClassName}),this.codeMirror.scrollIntoView(s)}clearHighlight(){null!=this.lastHighlightMarker&&this.lastHighlightMarker.clear()}markError(t){const s=t.match(/^Line ([0-9]+)/)[1],e=t.match(/([ ]+)\^$/)[1],i=parseInt(s)-1,h=e.length-9,o={line:i,ch:h},r={line:i,ch:h+1};this.lastErrorMarker=this.codeMirror.markText(o,r,{className:this.errorClassName}),this.codeMirror.scrollIntoView(o)}clearError(){null!=this.lastErrorMarker&&this.lastErrorMarker.clear()}}})(),sidila=i})();